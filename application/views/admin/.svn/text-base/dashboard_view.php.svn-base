<?php $CI = get_instance(); ?> <!-- chat histry load --><?php     $CI->load->model('chat_model');    $chats_details = $CI->chat_model->get_with_join(array('chat.chat_id','chat.massage','admin.admin_id','admin.last_name','admin.first_name','admin.user_name','admin.created','admin.image as user_image'), $id = NULL, $single = FALSE, $perpage=10, $start=0, $array='array'); ?><script type="text/javascript">    // globel varibles    var initial_chat_id = 0;    var last_chat_id = 0;</script><div class="row">    <div class="col-lg-12">        <h1 class="page-header">Dashboard</h1>    </div><!-- /.col-lg-12 --></div><div class="row sumery_count_row">    <div class="col-lg-3">        <div class="well">Unreaded booking<span class="badge pull-right" id="unreaded_bookiing_count">0</span></div>    </div> <!-- ./col-lg-3 -->    <div class="col-lg-3">        <div class="well">Offline vehicle<span class="badge pull-right" id="unavailabel_vehicle1"><?php if(isset($offline_vehicle_count)){echo $offline_vehicle_count;} else{echo "0";} ?></span></div>    </div> <!-- ./col-lg-3 -->    <div class="col-lg-3">        <div class="well">Today hire count <span class="badge pull-right"><?php if(isset($today_hired_count)){echo $today_hired_count;} else{echo "0";} ?></span></div>    </div> <!-- ./col-lg-3 -->    <div class="col-lg-3">    <div class="well">Today driver count<span class="badge pull-right"><?php if(isset($driver_count_by_date_range)){echo($driver_count_by_date_range); } else{echo "0";} ?></span></div></div> <!-- ./col-lg-3 --></div class="row sumery_count_row"><!-- /.row --><div class="row">    <div class="col-lg-8">        <div class="panel panel-default">            <div class="panel-heading">                <i class="fa fa-bar-chart-o fa-fw"></i> Area Chart for month earn value                <div class="pull-right">                    <div id="monthly_earn_chart">  </div>                </div>            </div> <!-- /.panel-heading -->            <div class="panel-body">                <div id="morris-area-chart"></div>            </div> <!-- /.panel-body -->        </div> <!-- /.panel -->        <div class="panel panel-default">            <div class="panel-heading">                <i class="fa fa-bar-chart-o fa-fw"></i> 2014 Hire count chart                <div class="pull-right">                    <!-- <div class="btn-group">                        <button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown">                            Actions                            <span class="caret"></span>                        </button>                        <ul class="dropdown-menu pull-right" role="menu">                            <li><a href="#">Action</a></li>                            <li><a href="#">Another action</a></li>                            <li><a href="#">Something else here</a></li>                            <li class="divider"></li>                            <li><a href="#">Separated link</a></li>                        </ul>                    </div> -->                </div>            </div> <!-- /.panel-heading -->            <div class="panel-body">                <div class="row">                    <div class="col-lg-12">                        <div id='multiline_chart'>                                                                                    </div> <!-- /.table-responsive -->                    </div> <!-- /.col-lg-4 (nested) -->                    <div class="col-lg-8">                        <div id="morris-bar-chart"></div>                    </div> <!-- /.col-lg-8 (nested) -->                </div> <!-- /.row -->            </div> <!-- /.panel-body -->        </div> <!-- /.panel -->        <div class="panel panel-default">            <div class="panel-heading">                <i class="fa fa-clock-o fa-fw"></i> Monthly Traveled dsitance            </div> <!-- /.panel-heading -->            <div class="panel-body">                 <div id="traveled_line_chart" style="min-width: 310px; height: 400px; margin: 0 auto"></div>            </div> <!-- /.panel-body -->        </div>        <!-- /.panel -->    </div>    <!-- /.col-lg-8 -->    <div class="col-lg-4">        <div class="chat-panel panel panel-default">            <div class="panel-heading">                <i class="fa fa-comments fa-fw"></i>                Chat                <div class="btn-group pull-right">                    <button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown">                        <i class="fa fa-chevron-down"></i>                    </button>                    <ul class="dropdown-menu slidedown">                        <li>                            <a href="#" id="chat_refresh_btn">                                <i class="fa fa-refresh fa-fw"></i> Make as read                            </a>                        </li>                                                <li>                            <a href="#">                                <i class="fa fa-sign-out fa-fw"></i> Sign Out                            </a>                        </li>                    </ul>                </div>            </div> <!-- /.panel-heading -->            <div class="panel-body" id="dashboard_page_chat_body">                <ul class="chat" id='dashboard_page_chat_ul'>                  </ul>                <input type="hidden" id='last_chat_id' value='0' >            </div> <!-- /.panel-body -->            <!-- massge type here -->            <div class="panel-footer">                <div class="input-group">                    <input id="btn-input" type="text" class="form-control input-sm chat_input" placeholder="Type your message here..." />                    <span class="input-group-btn">                        <button class="btn btn-warning btn-sm" id="btn-chat">                            Send                        </button>                    </span>                </div>            </div> <!-- /.panel-footer -->        </div> <!-- /.panel /.chat-panel -->         <!-- /.Notifications Panel -->        <div class="panel panel-default">            <div class="panel-heading">                <i class="fa fa-bell fa-fw"></i> Quick links            </div> <!-- /.panel-heading -->            <div class="panel-body">                <div class="list-group">                    <a href="<?php echo(site_url('admin/driver/add')); ?>" class="list-group-item">                        <i class="fa fa-comment fa-fw"></i> Add a driver                        <span class="pull-right text-muted small"><em>4 minutes ago</em>                        </span>                    </a>                    <a href="<?php echo(site_url('admin/website_booking/')); ?>" class="list-group-item">                        <i class="fa fa-twitter fa-fw"></i> List quick booking                        <span class="pull-right text-muted small"><em>12 minutes ago</em>                        </span>                    </a>                    <a href="<?php echo(site_url('admin/inform_car/add')); ?>" class="list-group-item">                        <i class="fa fa-envelope fa-fw"></i> Inform a car                        <span class="pull-right text-muted small"><em>27 minutes ago</em>                        </span>                    </a>                    <a href="<?php echo(site_url('admin/journey/add')); ?>" class="list-group-item">                        <i class="fa fa-tasks fa-fw"></i> Add hire details                        <span class="pull-right text-muted small"><em>43 minutes ago</em>                        </span>                    </a>                    <a href="<?php echo(site_url('admin/today_vehicle_driver/add')); ?>" class="list-group-item">                        <i class="fa fa-upload fa-fw"></i> Add Car driver log                        <span class="pull-right text-muted small"><em>11:32 AM</em>                        </span>                    </a>                    <a href="<?php echo(site_url('admin/today_vehicle_driver')); ?>" class="list-group-item">                        <i class="fa fa-bolt fa-fw"></i> List car driver log                        <span class="pull-right text-muted small"><em>11:13 AM</em>                        </span>                    </a>                    <a href="<?php echo(site_url('admin/vehicle_log/current_locaitons')); ?>" class="list-group-item">                       <i class="fa fa-warning fa-fw"></i> Vehicles current locations                       <span class="pull-right text-muted small"><em>10:57 AM</em>                       </span>                   </a>                   <!-- <a href="#" class="list-group-item">                       <i class="fa fa-shopping-cart fa-fw"></i> New Order Placed                       <span class="pull-right text-muted small"><em>9:49 AM</em>                       </span>                   </a>                   <a href="#" class="list-group-item">                       <i class="fa fa-money fa-fw"></i> Payment Received                       <span class="pull-right text-muted small"><em>Yesterday</em>                       </span>                   </a> -->                </div>                <!-- /.list-group -->                <!-- <a href="#" class="btn btn-default btn-block">View All Alerts</a> -->            </div> <!-- /.panel-body /.Notifications Panel-->        </div>        <!-- /.panel -->        <!-- Donut Chart -->        <!-- <div class="panel panel-default">             <div class="panel-heading">                 <i class="fa fa-bar-chart-o fa-fw"></i> Donut Chart Example             </div>             <div class="panel-body">                 <div id="container" style="min-width: 310px; height: 400px; max-width: 600px; margin: 0 auto"></div>                 <a href="#" class="btn btn-default btn-block">View Details</a>             </div> /.panel-body         </div> --> <!-- /.panel /.Donut Chart-->    </div>    <!-- /.col-lg-4 --></div><!-- /.row --> <script>    jQuery(document).ready(function($) {        // chat list loader        /**         * @author                          Madhuranga Senadheera         * Purpose of the function          Get ajax list         * @return_type                     none         */        function ajax_update_chat_list()        {            $.ajax({                url: '<?php echo(site_url("admin/chat/ajax_get/")); ?>',                type: 'POST',                dataType: 'json',                data: {last_chat_id:last_chat_id},            })            .done(function(response)            {                console.log("success");                                if (response.status!='error')                {                    chat_html =' ';                    for (var i = 0; i < response.chat_details.length; i++)                     {                        switch(response.chat_details[i].user_type) {                            case 'driver':                                 chat_html +='<li class="right clearfix">'+                                    '<span class="chat-img pull-right">'+                                        '<img width="50px" src="<?php echo(base_url('upload/img/driver')); ?>/'+response.chat_details[i].driver_image+'" alt="'+response.chat_details[i].driver_name+'" class="img-circle" />'+                                    '</span>'+                                    '<div class="chat-body clearfix">'+                                        '<div class="header">'+                                            '<small class=" text-muted">'+                                                '<i class="fa fa-clock-o fa-fw"></i>'+response.chat_details[i].created+'</small>'+                                            '<strong class="pull-right primary-font">'+response.chat_details[i].driver_name+'</strong>'+                                        '</div>'+                                        '<p>'+response.chat_details[i].massage+'</p>'+                                    '</div>'+                                '</li>';                                break;                            case 'admin':                                chat_html +='<li class="left clearfix">'+                                    '<span class="chat-img pull-left">'+                                        '<img width="50px" src="<?php echo(base_url('upload/img/admin')); ?>/'+response.chat_details[i].admin_image+'" alt="'+response.chat_details[i].admin_name+'" class="img-circle" />'+                                    '</span>'+                                    '<div class="chat-body clearfix">'+                                        '<div class="header">'+                                            '<small class=" text-muted">'+                                                '<i class="fa fa-clock-o fa-fw"></i>'+response.chat_details[i].created+'</small>'+                                            '<strong class="pull-left primary-font">'+response.chat_details[i].admin_name+'</strong>'+                                        '</div>'+                                        '<p>'+response.chat_details[i].massage+'</p>'+                                    '</div>'+                                '</li>';                                break;                         }                        $('#dashboard_page_chat_ul').append(chat_html);                    };                    // add initial chat id                    if(initial_chat_id==0){initial_chat_id =response.chat_details[0].chat_id; }                    // set last chat id                     last_chat_id =response.chat_details[(response.chat_details.length-1)].chat_id                    // scroll down                    $('#dashboard_page_chat_body').scrollTop( $('#dashboard_page_chat_ul').height());                    // $('#btn-input').val('');                }                                              })            .fail(function() {                console.log("error");            })            .always(function() {                console.log("complete");            });                   }        /*---------------- ---------End of update_chat_list()---------------------------*/        // Chat as read        /**         * @author                          Madhuranga Senadheera         * Purpose of the function          make as read unreaded chat         * @return_type                     none         */        function ajax_chat_make_as_read()        {            $.ajax({                url: '<?php echo(site_url("admin/chat/chat_make_as_read/")); ?>',                type: 'POST',                dataType: 'html',                data: {initial_chat_id:initial_chat_id,last_chat_id:last_chat_id},            })            .done(function(response)            {                console.log("success");                                if (response.status=='success')                {                    // last chat id update                    $('#last_chat_id').val(response.chat_details[(response.chat_details.length-1)].chat_id);                }                              })            .fail(function() {                console.log("make_as_read_error");            })            .always(function() {                console.log("complete");            });        }/*---------------- ---------End of update_chat_list()---------------------------*/        /**         * @author                          Madhuranga Senadheera         * Purpose of the function          Add chat          * @return_type                     none         */        function ajax_add_chat()        {            $.ajax({                url: '<?php echo(site_url("admin/chat/ajax_add/")); ?>',                type: 'POST',                dataType: 'json',                data: {massage: $('.chat_input').val()},            })            .done(function(response) {                console.log("success");                // clear chat box                $('#btn-input').val('');                // update chat history                ajax_update_chat_list();                            })            .fail(function() {                console.log("error");            })            .always(function() {                console.log("complete");            });        }//Function End ajax_add_chat()---------------------------------------------------FUNEND()          /**         * @author                          Madhuranga Senadheera         * Purpose of the function          update the summery row in dash board         * @return_type                     none         */        function update_summery_row()        {            $.ajax({                url: '<?php echo(site_url("admin/dashboard/get_dashbord_summery_count_row/")); ?>',                type: 'POST',                dataType: 'json',                data: {data:'nodatasend'},            })            .done(function(response) {                 // console.log("dashboard_success");                $('#unavailabel_vehicle').html(response.get_unavailable)                $('#unreaded_bookiing_count').html(response.unreaded_booking_count)            })            .fail(function() {                console.log("error");            })            .always(function() {                console.log("complete");            });        }        /*---------------- ---------End of update_summery_row()---------------------------*/                 //-*****************************************function caller*************************-        // make as read        //**initial runers************************************        //            // udpate the dashboard summery count            update_summery_row();        // **initial runers()********************************end()        $('#chat_refresh_btn').click(function(event) {            event.preventDefault();            ajax_chat_make_as_read();        });         // chat add        $('.btn-sm').click(function(event) {            ajax_add_chat();                    });               //  always runner        setInterval(function () {            ajax_update_chat_list();            update_summery_row();        }, 30000);        //-*****************************************function caller end()*************************    }); </script> <!-- pie chart get data --><?php      $CI->load->model('journey_model');//get_by($where='', $fields = NULL, $id = NULL, $single = FALSE, $perpage=0, $start=0, $array='array')    $this->db->join('vehicle', 'vehicle.vehicle_id = journey.vehicle_id','left');        $this->db->join('driver', 'driver.driver_id = journey.driver_id','left');    $this->db->group_by('journey.driver_id');        $chats_details = $CI->journey_model->get_by(array('driver.status'=>'A'),array('driver.driver_id','driver.last_name as driver_name','sum(journey.cash) as sum_cash'), $id = NULL, $single = FALSE, $perpage=100, $start=0, $array='array');    $piechart_json_array = array();    foreach ($chats_details as $key => $value) {        array_push( $piechart_json_array, array('name'=>$value['driver_name'],'y'=>(1*$value['sum_cash'])));    } ?><!-- chart js --><script src="http://code.highcharts.com/highcharts.js"></script><script src="http://code.highcharts.com/modules/exporting.js"></script><script>// pie chart monthly earn value    $(function () {    $('#monthly_earn_chart').highcharts({        credits: {            enabled: false        },        chart: {            plotBackgroundColor: null,            plotBorderWidth: 1,//null,            plotShadow: false        },        title: {            text: 'This month earns 2014 - AUG'        },        tooltip: {            pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'        },        plotOptions: {            pie: {                allowPointSelect: true,                cursor: 'pointer',                dataLabels: {                    enabled: true,                    format: '<b>{point.name}</b>: {point.percentage:.1f} %',                    style: {                        color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'                    }                }            }        },        yAxis: {            min: 0        },        series: [{            type: 'pie',            name: 'User presentage',            data: <?php echo(json_encode($piechart_json_array)); ?>        }]    });});</script><!-- monthly hire count line chart --><script>    $(function () {    $('#multiline_chart').highcharts({        credits: {            enabled: false        },        title: {            text: 'Hire count monthly wise',            x: -20 //center        },        subtitle: {            text: '2014 Jan to 2014 - Dec',            x: -20        },        xAxis: {            categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun',                'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']        },        yAxis: {            title: {                text: 'Hire count '            },            min: 0,            plotLines: [{                value: 0,                width: 1,                color: '#808080'            }]        },        tooltip: {            valueSuffix: '.'        },        legend: {            layout: 'vertical',            align: 'right',            verticalAlign: 'middle',            borderWidth: 0        },        series: [{            name: 'Hires',            data: <?php echo $get_year_hire_count ?>            // data: [7.0, 6.9, 9.5, 14.5, 18.2, 21.5, 25.2, 26.5, 23.3, 18.3, 13.9, 9.6]        }        /*, {            name: 'New York',            data: [-0.2, 0.8, 5.7, 11.3, 17.0, 22.0, 24.8, 24.1, 20.1, 14.1, 8.6, 2.5]        }, {            name: 'Berlin',            data: [-0.9, 0.6, 3.5, 8.4, 13.5, 17.0, 18.6, 17.9, 14.3, 9.0, 3.9, 1.0]        }, {            name: 'London',            data: [3.9, 4.2, 5.7, 8.5, 11.9, 15.2, 17.0, 16.6, 14.2, 10.3, 6.6, 4.8]        }*/        ]    });});</script><!-- Monthly travel distance --><script>    $(function () {        $('#traveled_line_chart').highcharts({            credits: {                enabled: false            },            chart: {                type: 'line'            },            title: {                text: 'Monthly Traveled distance Km'            },            subtitle: {                text: '2014 Jan to 2014 - Dec'            },            xAxis: {                categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']            },            yAxis: {                title: {                    text: 'Km'                },                min:0            },            plotOptions: {                line: {                    dataLabels: {                        enabled: true                    },                    enableMouseTracking: false                }            },            series:<?php echo $get_year_km_count ?>                     });    });</script>